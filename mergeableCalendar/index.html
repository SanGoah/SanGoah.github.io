<!DOCTYPE html><html><head><meta charset="utf-8"><title>日历</title><link rel="stylesheet" href="./style_calendar.css"><link rel="stylesheet" href="./contextmenu.css"><script src="./jquery.min.js"></script><script src="./contextmenu.js"></script><script src="./calendar.js"></script><script type="text/javascript">
        var today = new Date(),
            year = today.getFullYear(),
            month = today.getMonth() + 1,
            date = today.getDate(),
            cur_calendar = 0,
            calendar_list = ["总览", "追梦赤子心", "橙色天空之下", "诸神的黄昏", "春风又绿江南岸", "僧伽蓝摩", "水脚浮青靛，湖唇滉白沙", "紫罗兰永恒花园"],
            colors_doing = ["#6C6C6C", "Crimson", "Tomato", "darkorange", "ForestGreen", "DarkTurquoise", "DodgerBlue", "#4A4AFF"],
            colors_finished = ["#E0E0E0", "#FFD2D2	", "#FFDAC8", "#FFF4C1", "#E8FFC4", "#D7FFEE", "#C4E1FF", "#DDDDFF"],
            archive = [{
                "startDate": year + "-" + month + "-" + date,
                "isFinished": false,
                "calendar_idx": 0,
                "name": "欢迎使用本日历~"
            }];

        function saveArchive() {
            if (typeof (Storage) !== "undefined")
                localStorage.archive = JSON.stringify(archive);
            else
                alert("此浏览器不支持存档。");
        };
        function saveNameList() {
            if (typeof (Storage) !== "undefined")
                localStorage.name_list = JSON.stringify(calendar_list);
            else
                alert("此浏览器不支持存档。");
        };

        var callback = function (data) {
            if (data.hasOwnProperty("do")) {
                if (data.do == "clear") {
                    var idx_in_archive = 1;
                    if (cur_calendar == 0) {
                        while (idx_in_archive != -1) {
                            idx_in_archive = archive.findIndex(o => o.startDate === data.startDate);
                            archive.splice(idx_in_archive, 1);
                        }
                    }
                    else {
                        while (idx_in_archive != -1) {
                            idx_in_archive = archive.findIndex(o => o.startDate === data.startDate && o.calendar_idx == cur_calendar);
                            archive.splice(idx_in_archive, 1);
                        }
                    }
                }
                else {
                    let idx_in_archive = archive.findIndex(o => o.name === data.event && o.startDate === data.startDate);
                    if (data.do == "finish")
                        archive[idx_in_archive].isFinished = true;
                    if (data.do == "delete")
                        archive.splice(idx_in_archive, 1);
                }
                saveArchive();
                $("#calendar").data("calendar").loadData(archive);
            }
        },
            menu_model = {
                menus: [{
                    title: '☑完成',
                    callback: function (data) {
                        callback(data);
                    },
                    children: []
                }, {
                    title: '🗙删除',
                    callback: function (data) {
                        callback(data);
                    },
                    children: []
                }, {
                    title: '🗑清空',
                    callback: function (data) {
                        callback(data);
                    },
                    children: []
                }]
            },
            menus = [];
    </script><link rel="alternate" href="/atom.xml" title="Mech_Mind's blog" type="application/atom+xml"></head><body><div id="calendar"></div><div><p>MergeableCalendar Version 0.1.0</p><p style="color:gray"> 单击以为某日增添新事项，右击以操作某日的事项。<br> 可执行的操作有：指定一事项进行删除、指定一事项标记为完成、清空在当前视图下可见的当日所有事项。<br> 本日历拥有一个总览视图和七个子视图。每个子视图均可以自定义名称。暂不支持新增和删除子视图。<br> 本应用需要 Web Storage 支持，请使用 Chrome 4.0+ 或 IE 8.0+ 或 FireFox 3.5+ 或 Safari 4.0+ 或 Opera 11.5+ 浏览器打开本应用。<br> 希望这个小工具能帮助到你，使用愉快୧(๑•̀⌄•́๑)૭✧</p></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginModelPath:"assets/",model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:200,height:290},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><script>

    console.log(localStorage);
    //localStorage以字符串形式存储
    //eval一次转一层，子对象仍然是字符串
    var userData = eval(localStorage);
    if (userData.hasOwnProperty("name_list"))
        calendar_list = eval(userData.name_list);
    if (userData.hasOwnProperty("archive") && "startDate" in eval(userData.archive)[0])
        archive = eval(userData.archive);

    $("#calendar").calendar({
        data: archive,
        mode: "month",
        //maxEvent: 1,
        showModeBtn: false,
        newDate: year + "-" + month + "-" + date,

        cellClick: function (res) {
            var input = prompt("为【" + calendar_list[cur_calendar] + "】" + res.date + "添加事务", "");
            if (input) {
                let idx_in_archive = archive.findIndex(o => o.name === input && o.startDate === res.date);
                if (idx_in_archive == -1) {
                    var str = {
                        "startDate": res.date,
                        "calendar_idx": cur_calendar,
                        "name": input
                    }
                    archive.push(str);
                    saveArchive();
                    $("#calendar").data("calendar").loadData(archive);
                }
                else
                    alert("同一天不能有重名事项，不在同一个分日历里也不行╮(╯_╰)╭");
            }
        },

    })

</script>