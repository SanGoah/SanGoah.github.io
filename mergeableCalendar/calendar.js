var Calendar=function(e,t){this.el=$(e),this.options=$.extend(!0,{},this.options,t),this.init()};Calendar.prototype={options:{mode:"month",weekMode:["‰∏Ä","‰∫å","‰∏â","Âõõ","‰∫î","ÂÖ≠","Êó•"],newDate:new Date,width:null,height:null,showModeBtn:!0,showEvent:!0,maxEvent:null},init:function(){var e=this,t=e.el,a=e.options;t.addClass("calendar"),a.width=t.width(),a.height=t.height(),"string"==typeof a.newDate&&(a.newDate=e._getDateByString(a.newDate)),e._createCalendar(),t.on("click",".calendar-mode-select .btn",(function(t){$(".calendar-select-active").removeClass("calendar-select-active"),t.stopPropagation();var n=$(this).text();cur_calendar=calendar_list.indexOf(n),cur_calendar?$(".calendar-rename-text").text("ÈáçÂëΩÂêçÊú¨ËßÜÂõæ"):$(".calendar-rename-text").text(" by Mech_Mind "),$(this).addClass("calendar-select-active"),e._refreshCalendar(a.newDate)})),t.on("touchend",".calendar-cell",(function(t){t.stopPropagation(),$(".dropdown-month").removeClass("open"),$(".dropdown-year").removeClass("open");var n=new Date($(this).attr("title").replace(/[\u4e00-\u9fa5]/g,",")),l=e.viewData,c=n.getFullYear(),r=n.getMonth(),o=n.getDate();"year"==a.mode?a.cellClick&&a.cellClick.call(e,{events:l[r]?l[r]:[],date:c+"-"+(r+1)}):"month"==a.mode&&r==a.newDate.getMonth()&&a.cellClick&&a.cellClick.call(e,{events:l[o]?l[o]:[],date:c+"-"+(r+1)+"-"+o})})),t.on("click",".calendar-cell",(function(t){t.stopPropagation(),$(".dropdown-month").removeClass("open"),$(".dropdown-year").removeClass("open");var n=new Date($(this).attr("title").replace(/[\u4e00-\u9fa5]/g,",")),l=e.viewData,c=n.getFullYear(),r=n.getMonth(),o=n.getDate();"year"==a.mode?a.cellClick&&a.cellClick.call(e,{events:l[r]?l[r]:[],date:c+"-"+(r+1)}):"month"==a.mode&&r==a.newDate.getMonth()&&a.cellClick&&a.cellClick.call(e,{events:l[o]?l[o]:[],date:c+"-"+(r+1)+"-"+o})})),t.on("click",".calendar-rename",(function(e){if(e.stopPropagation(),$(".dropdown-month").removeClass("open"),$(".dropdown-year").removeClass("open"),$(".dropdown-name").removeClass("open"),cur_calendar){var t=prompt("‰∏∫„Äê"+calendar_list[cur_calendar]+"„ÄëÈáçÂëΩÂêç","");t&&(-1!=calendar_list.indexOf(t)?alert("‰∏çÂèØ‰ª•ÂëΩÂêçÈáçÂêçÁöÑÂ≠êËßÜÂõæ(‡πë‚Ä¢ÃÅ ‚ÇÉ ‚Ä¢ÃÄ‡πë)"):(calendar_list[cur_calendar]=t,saveNameList(),alert("Â∑≤ÈáçÂëΩÂêçÂ≠êËßÜÂõæÔºåËØ∑ÊâãÂä®Âà∑Êñ∞ÊµèËßàÂô®„ÉΩ(‚úøÔæü‚ñΩÔæü)„Éé")))}})),t.on("click",".calendar-name-select",(function(t){t.stopPropagation(),$(".dropdown-month").removeClass("open"),$(".dropdown-year").removeClass("open"),$(".dropdown-name").toggleClass("open");var a="";for(i in calendar_list)a+='<li class="name-item">',a+='<span class="name-check">'+calendar_list[i]+"</span>",a+="</li>";e.el.find(".dropdown-name").html(a)})),t.on("click",".calendar-year-select",(function(t){t.stopPropagation(),$(".dropdown-month").removeClass("open"),$(".dropdown-year").toggleClass("open");for(var n=a.newDate.getFullYear(),l="",c=0;c<21;c++)l+=10==c?'<li class="year-item active">':'<li class="year-item">',l+='<span class="year-check">'+(n-10+c)+"</span>",l+="<span >Âπ¥</span>",l+="</li>";e.el.find(".dropdown-year").html(l)})),t.on("click",".year-item",(function(t){t.stopPropagation(),$(".dropdown-year").removeClass("open");var n=$(this).text(),l=n.split("Âπ¥")[0];l!=a.newDate.getFullYear()&&(a.newDate.setFullYear(l),"month"==a.mode?e._refreshCalendar(a.newDate):e._refreshYearCalendar(a.newDate),$(".calendar-year-select").text(n))})),t.on("click",".calendar-month-select",(function(e){e.stopPropagation(),$(".dropdown-year").removeClass("open"),$(".dropdown-month").toggleClass("open")})),t.on("click",".month-item",(function(t){t.stopPropagation(),$(".dropdown-month").removeClass("open");var n=$(this).text(),l=n.split("Êúà")[0];if(l!=a.newDate.getMonth()+1){var c=a.newDate.getDate();a.newDate.setMonth(l-1),c!=a.newDate.getDate()&&a.newDate.setDate(a.newDate.getDate()-1),e._refreshCalendar(a.newDate),$(".calendar-month-select").text(n)}})),$(document.body).on("click",(function(e){$(".dropdown-month").removeClass("open"),$(".dropdown-year").removeClass("open")}))},changeMode:function(e){e!=this.options.mode&&(this.options.mode=e,this._createCalendar())},loadData:function(e){if(!e)throw"Êï∞ÊçÆÈîôËØØ";this.options.data=e,this._createCalendar()},getViewDate:function(e){var t=this.options,a=t.mode,n=t.data;if(!n||0==n.length)return[];for(var l={},c=e.getFullYear(),r=e.getMonth(),o=0;o<n.length;o++){var i=n[o],s=this._getDateByString(i.startDate),d=s.getFullYear(),h=s.getMonth(),u=s.getDate();"month"==a&&d==c&&r==h?(l[u]||(l[u]=[]),l[u].push(i)):"year"==a&&d==c&&(l[h]||(l[h]=[]),l[h].push(i))}menus=[];for(o=1;o<32;++o){var p;if(l[o]){p={menus:[{title:"‚úîÂÆåÊàê",callback:function(e){callback(e)},children:[]},{title:"üóôÂà†Èô§",callback:function(e){callback(e)},children:[]},{title:"üóëÊ∏ÖÁ©∫",callback:function(e){e.do="clear",e.startDate=c+"-"+(r+1)+"-"+e.data.date,callback(e)},children:[]}]};var m=!1;for(var g in l[o])l[o][g].calendar_idx!=cur_calendar&&0!=cur_calendar||(cur_event_finish={title:l[o][g].name,callback:function(e){e.do="finish",e.startDate=c+"-"+(r+1)+"-"+e.data.date,e.event=this.title,callback(e)}},cur_event_delete={title:l[o][g].name,callback:function(e){e.do="delete",e.startDate=c+"-"+(r+1)+"-"+e.data.date,e.event=this.title,callback(e)}},l[o][g].isFinished||p.menus[0].children.push(cur_event_finish),p.menus[1].children.push(cur_event_delete),m=!0);m||(p={menus:[{title:"üòÉÂΩìÊó•Âú®ËØ•ËßÜÂõæ‰∏ãÊó†‰∫ã",callback:function(e){callback(e)},children:[]}]})}else p={menus:[{title:"üòÉÂΩìÊó•Êó†‰∫ã",callback:function(e){callback(e)},children:[]}]};menus.push(p)}return l},_getDateByString:function(e){var t=e.split("-")[0],a=parseInt(e.split("-")[1])-1,n=e.split("-")[2];return new Date(t,a,n)},_createCalendar:function(){this.options.mode;this._createView()},_createView:function(){var e=this,t=e.el,a=e.options,n=a.mode,l=a.newDate,c="";c+=e._createToolbar(),c+='<div class="calendar-body">',c+='<table class="calendar-table" cellspacing="0">',"month"==n&&(c+=e._createHeader()),c+=e._createBody(),c+="</table>",c+="</div>",t.html(c),"month"==n?e._refreshCalendar(l):e._refreshYearCalendar(l)},_createToolbar:function(){var e,t=this.options.newDate,a="";a+='<div class="calendar-header">',a+='<div class="calendar-select">',a+='<div class="btn-group ">',a+='<span class="btn calendar-year-select" style="border-bottom-left-radius:4px;border-top-left-radius:4px;">'+t.getFullYear()+"Âπ¥</span >",a+='<ul id="dropdown-year" class="dropdown-year"></ul>',a+='<span class="btn calendar-month-select" style="border-bottom-right-radius:4px;border-top-right-radius:4px;">'+(t.getMonth()+1)+"Êúà</span >",a+='<ul class="dropdown-month">';for(var n=1;n<=12;n++)a+='<li class="month-item">',a+='<span class="month-check">'+n+"</span>",a+="<span >Êúà</span>",a+="</li>";for(var n in a+="</ul>",a+="</div > ",a+="</div > ",a+='<div class="calendar-select  calendar-mode-select">',a+='<div class="btn-group">',calendar_list)e=0==n?'style="border-bottom-left-radius:4px;border-top-left-radius:4px;"':n==calendar_list.length-1?'style="border-bottom-right-radius:4px;border-top-right-radius:4px;"':"",n==cur_calendar?a+='<span class="btn calendar-select-active" '+e+">"+calendar_list[n]+"</span>":a+='<span class="btn" '+e+">"+calendar_list[n]+"</span>";return a+="</div>",a+="</div>",a+='<div class="calendar-select calendar-rename" >',a+='<span class="calendar-rename-text"> by Mech_Mind </span ></div > ',a+="</div >"},_createHeader:function(){var e=this.options.weekMode,t="<thead><tr>";return e.forEach((function(e){t+=' <th class="calendar-column-header" title="Âë®'+e+'"><span class="calendar-column-header-inner">'+e+"</span></th>"})),t+="</thead></tr>"},_createBody:function(){return"</tbody>",' <tbody class="calendar-tbody"></tbody>'},_refreshCalendar:function(e){var t=this,a=t.options.showEvent,n=t.options.maxEvent,l="";t.viewData=viewData=t.getViewDate(e);var c=t._cloneDate(e),r=c.getDate();c.setDate(1);var o=0==c.getDay()?7:c.getDay(),i=t._cloneDate(c);i.setDate(i.getDate()-o+1);e.getTime(),i.getTime();renderDate=t._cloneDate(i);for(var s=1,d=0;d<6;d++){l+="<tr>";for(var h=0;h<7;h++){var u=renderDate.getFullYear(),p=renderDate.getMonth()+1,m=renderDate.getDate();renderDate.getMonth()<e.getMonth()?l+='<td title="'+u+"Âπ¥"+p+"Êúà"+m+'Êó•" class="calendar-cell calendar-last-month-cell">':renderDate.getMonth()>e.getMonth()?l+='<td title="'+u+"Âπ¥"+p+"Êúà"+m+'Êó•" class="calendar-cell calendar-next-month-cell">':l+=m==r?'<td title="'+u+"Âπ¥"+p+"Êúà"+m+'Êó•" class="calendar-cell calendar-today right-click-'+s+++'">':'<td title="'+u+"Âπ¥"+p+"Êúà"+m+'Êó•" class="calendar-cell right-click-'+s+++'">',l+='<div class="calendar-date">',l+='<div class="calendar-value">'+m+"</div>",l+='<div class="calendar-content"><ul class="events">',a&&viewData[m]&&renderDate.getMonth()==e.getMonth()&&(n&&viewData[m].length>n?l+='<span class="total">'+viewData[m].length+"‰∏™‰∫ã‰ª∂..</span>":viewData[m].forEach((function(e){e.isFinished?0==cur_calendar?l+='<li class="done" style="color:white;background-color:'+colors_finished[e.calendar_idx]+';"><span><s>'+e.name+"</s></span></li>":cur_calendar==e.calendar_idx&&(l+='<li class="done" style="color:white;background-color:'+colors_finished[e.calendar_idx]+';"><span><s>'+e.name+"</s></span></li>"):0==cur_calendar?l+='<li style="color:white;background-color:'+colors_doing[e.calendar_idx]+';"><span>'+e.name+"</span></li>":cur_calendar==e.calendar_idx&&(l+='<li style="color:white;background-color:'+colors_doing[e.calendar_idx]+';"><span>'+e.name+"</span></li>")}))),l+="</ul ></div > ",l+="</div></td>",renderDate.setDate(renderDate.getDate()+1)}l+="</tr>"}$((function(){$(".right-click-1").contextMenu(menus[0],{date:1}),$(".right-click-2").contextMenu(menus[1],{date:2}),$(".right-click-3").contextMenu(menus[2],{date:3}),$(".right-click-4").contextMenu(menus[3],{date:4}),$(".right-click-5").contextMenu(menus[4],{date:5}),$(".right-click-6").contextMenu(menus[5],{date:6}),$(".right-click-7").contextMenu(menus[6],{date:7}),$(".right-click-8").contextMenu(menus[7],{date:8}),$(".right-click-9").contextMenu(menus[8],{date:9}),$(".right-click-10").contextMenu(menus[9],{date:10}),$(".right-click-11").contextMenu(menus[10],{date:11}),$(".right-click-12").contextMenu(menus[11],{date:12}),$(".right-click-13").contextMenu(menus[12],{date:13}),$(".right-click-14").contextMenu(menus[13],{date:14}),$(".right-click-15").contextMenu(menus[14],{date:15}),$(".right-click-16").contextMenu(menus[15],{date:16}),$(".right-click-17").contextMenu(menus[16],{date:17}),$(".right-click-18").contextMenu(menus[17],{date:18}),$(".right-click-19").contextMenu(menus[18],{date:19}),$(".right-click-20").contextMenu(menus[19],{date:20}),$(".right-click-21").contextMenu(menus[20],{date:21}),$(".right-click-22").contextMenu(menus[21],{date:22}),$(".right-click-23").contextMenu(menus[22],{date:23}),$(".right-click-24").contextMenu(menus[23],{date:24}),$(".right-click-25").contextMenu(menus[24],{date:25}),$(".right-click-26").contextMenu(menus[25],{date:26}),$(".right-click-27").contextMenu(menus[26],{date:27}),$(".right-click-28").contextMenu(menus[27],{date:28}),$(".right-click-29").contextMenu(menus[28],{date:29}),$(".right-click-30").contextMenu(menus[29],{date:30}),$(".right-click-31").contextMenu(menus[30],{date:31})})),t.el.find(".calendar-tbody").html(l)},_cloneDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}},$.fn.calendar=function(e){var t,a,n="string"==typeof e;n&&(t=$.makeArray(arguments)).splice(0,1);var l="calendar",c=Calendar,r=this.each((function(){var r=$.data(this,l);r||(r=new c(this,e),$.data(this,l,r)),n&&(a=r[e].apply(r,t))}));return n?a:r};